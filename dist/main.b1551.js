!function(t){var e={};function i(o){if(e[o])return e[o].exports;var n=e[o]={i:o,l:!1,exports:{}};return t[o].call(n.exports,n,n.exports,i),n.l=!0,n.exports}i.m=t,i.c=e,i.d=function(t,e,o){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:o})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var o=Object.create(null);if(i.r(o),Object.defineProperty(o,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var n in t)i.d(o,n,function(e){return t[e]}.bind(null,n));return o},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=4)}([function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Duration=e.Panel=e.GameStatus=e.Direction=e.GameConfig=e.BlockConfig=void 0,function(t){t[t.width=30]="width",t[t.height=30]="height"}(e.BlockConfig||(e.BlockConfig={})),function(t){t[t.width=10]="width",t[t.height=15]="height"}(e.GameConfig||(e.GameConfig={})),function(t){t[t.down=0]="down",t[t.right=1]="right",t[t.left=2]="left"}(e.Direction||(e.Direction={})),function(t){t[t.init=0]="init",t[t.playing=1]="playing",t[t.pause=2]="pause",t[t.over=3]="over"}(e.GameStatus||(e.GameStatus={})),function(t){t[t.width=5]="width",t[t.height=5]="height"}(e.Panel||(e.Panel={})),function(t){t[t.default=1e3]="default"}(e.Duration||(e.Duration={}))},function(t,e){t.exports=$},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.TerisRules=e.Teris=e.ZShape=e.SShape=e.JShape=e.LShape=e.OShape=e.YiShape=e.TShape=void 0;var o=i(0),n=i(3);e.TShape=[[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:-1,y:0}],[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:0,y:1}],[{x:0,y:0},{x:-1,y:0},{x:1,y:0},{x:0,y:1}],[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:1}]],e.YiShape=[[{x:0,y:0},{x:0,y:1},{x:0,y:2},{x:0,y:3}],[{x:0,y:0},{x:1,y:0},{x:2,y:0},{x:3,y:0}]],e.OShape=[[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:1,y:1}]],e.LShape=[[{x:0,y:0},{x:1,y:0},{x:0,y:-1},{x:0,y:-2}],[{x:0,y:0},{x:0,y:1},{x:1,y:0},{x:2,y:0}],[{x:0,y:0},{x:-1,y:0},{x:0,y:1},{x:0,y:2}],[{x:0,y:0},{x:0,y:-1},{x:-1,y:0},{x:-2,y:0}]],e.JShape=[[{x:0,y:0},{x:-1,y:0},{x:0,y:-1},{x:0,y:-2}],[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:2,y:0}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:2}],[{x:0,y:0},{x:0,y:1},{x:-1,y:0},{x:-2,y:0}]],e.SShape=[[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1}]],e.ZShape=[[{x:0,y:0},{x:0,y:-1},{x:1,y:0},{x:1,y:1}],[{x:0,y:0},{x:1,y:0},{x:0,y:1},{x:-1,y:1}]];var r=function(){function t(){}return t.createTeris=function(){return this.TerisShape[n.getRandom(0,this.TerisShape.length)]},t.createColor=function(){return n.gerRandomColor()},t.TerisShape=[e.TShape,e.YiShape,e.OShape,e.LShape,e.JShape,e.SShape,e.ZShape],t}();e.Teris=r;var s=function(){function t(){}return t.canIMove=function(t,e,i){var n=t.map((function(t){return{x:t.x+e.x,y:t.y+e.y}})),r=!n.some((function(t){return t.x<0||t.x>o.GameConfig.width-1||t.y<0||t.y>o.GameConfig.height-1}));return r&&i.length>0&&(r=!n.some((function(t){return i.some((function(e){return t.x===e.x&&t.y===e.y}))}))),r},t}();e.TerisRules=s},function(t,e,i){"use strict";function o(t,e){return Math.floor(Math.random()*(e-t)+t)}Object.defineProperty(e,"__esModule",{value:!0}),e.gerRandomColor=e.getRandom=void 0,e.getRandom=o,e.gerRandomColor=function(){return"rgb("+o(50,255)+","+o(50,255)+","+o(50,255)+")"}},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=i(5),n=i(9);new o.Game(new n.GameViewer)},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.Game=void 0;var n=i(0),r=i(2),s=i(6),a=o(i(1)),u=i(3),c=function(){function t(t){this._viewer=t,this._curStatus=n.GameStatus.init,this._dureation=n.Duration.default,this._exites=[],this._timer=void 0,this._grade=0,t.init(this),this.init()}return t.prototype.init=function(){var t,e;this._curStatus=n.GameStatus.init,this._dureation=n.Duration.default,this.grade=0,this._timer&&(clearInterval(this._timer),this._timer=void 0),null===(t=this._curBlockGrops)||void 0===t||t.blockGrops.forEach((function(t){var e;null===(e=t.viewer)||void 0===e||e.remove()})),this._curBlockGrops=void 0,null===(e=this._nextBlockGrops)||void 0===e||e.blockGrops.forEach((function(t){var e;null===(e=t.viewer)||void 0===e||e.remove()})),this._exites.forEach((function(t){var e;null===(e=t.viewer)||void 0===e||e.remove()})),this._exites=[],this.createNext()},t.prototype.start=function(){this._curStatus===n.GameStatus.init?(this._curStatus=n.GameStatus.playing,this.switchGrops(),this.autoMove()):this._curStatus===n.GameStatus.pause&&(this._curStatus=n.GameStatus.playing,this.autoMove())},t.prototype.pause=function(){var t;this._curStatus===n.GameStatus.playing&&(this._curStatus=n.GameStatus.pause,this._timer&&(clearInterval(this._timer),this._timer=void 0),null===(t=this._viewer)||void 0===t||t.pause())},t.prototype.autoMove=function(){var t=this;this._timer||this._curBlockGrops&&(this._timer=setInterval((function(){if(t._curBlockGrops){var e={x:t._curBlockGrops.centerPoint.x,y:t._curBlockGrops.centerPoint.y+1};t.testPoint(t._curBlockGrops.getCurTeris(),e)?(t._curBlockGrops.blockGrops.forEach((function(e){t._exites.push(e)})),t.switchGrops()):t._curBlockGrops.pointhandler(e)}}),this._dureation))},t.prototype.switchGrops=function(){var t,e;if(this._curStatus===n.GameStatus.playing&&this._nextBlockGrops){this._curBlockGrops=this._nextBlockGrops,this._nextBlockGrops.blockGrops.forEach((function(t){var e;null===(e=t.viewer)||void 0===e||e.remove()}));var i={x:Math.floor(n.GameConfig.width/2),y:this._curBlockGrops.centerPoint.y};if(this.testPoint(null===(t=this._curBlockGrops)||void 0===t?void 0:t.getCurTeris(),i))return this._curStatus=n.GameStatus.over,this._timer&&(clearInterval(this._timer),this._timer=void 0),void(null===(e=this._viewer)||void 0===e||e.over());this._curBlockGrops.changeDom(a.default("#game")),this._curBlockGrops.pointhandler({x:Math.floor(n.GameConfig.width/2),y:this._curBlockGrops.centerPoint.y}),this.createNext(),this.grade=this._grade+this.deleteBlock()}},t.prototype.createNext=function(){for(var t=r.Teris.createTeris(),e={x:Math.floor(n.Panel.width/2),y:0},i=u.getRandom(0,t.length);this.testPoint(t[i],e);)e.y++;this._nextBlockGrops=new s.BlockGrops(t,e,i)},t.prototype.testPoint=function(t,e){var i=this,o=t.map((function(t){return{x:t.x+e.x,y:t.y+e.y}})),r=o.some((function(t){return t.x<0||t.x>n.GameConfig.width-1||t.y<0||t.y>n.GameConfig.height-1}));return!r&&this._exites.length>0&&(r=o.some((function(t){return i._exites.some((function(e){return t.x===e.point.x&&t.y===e.point.y}))}))),r},t.prototype.deleteBlock=function(){for(var t=this,e=0,i=function(i){var r=o._exites.filter((function(t){return t.point.y===i}));r.length===n.GameConfig.width&&(r.forEach((function(e){var i;null===(i=e.viewer)||void 0===i||i.remove();var o=t._exites.indexOf(e);t._exites.splice(o,1)})),o._exites.forEach((function(t){t.point.y<i&&(t.point={x:t.point.x,y:t.point.y+1})})),e++)},o=this,r=0;r<n.GameConfig.height;r++)i(r);return e},t.prototype.rotate=function(){this._curStatus===n.GameStatus.playing&&this._curBlockGrops&&(this.testPoint(this._curBlockGrops.getNextTeris(),this._curBlockGrops.centerPoint)||this._curBlockGrops.changeIndex())},t.prototype.left=function(){if(this._curStatus===n.GameStatus.playing&&this._curBlockGrops){var t={x:this._curBlockGrops.centerPoint.x-1,y:this._curBlockGrops.centerPoint.y};this.testPoint(this._curBlockGrops.getCurTeris(),t)||this._curBlockGrops.pointhandler(t)}},t.prototype.right=function(){if(this._curStatus===n.GameStatus.playing&&this._curBlockGrops){var t={x:this._curBlockGrops.centerPoint.x+1,y:this._curBlockGrops.centerPoint.y};this.testPoint(this._curBlockGrops.getCurTeris(),t)||this._curBlockGrops.pointhandler(t)}},t.prototype.down=function(){var t=this;if(this._curStatus===n.GameStatus.playing&&this._curBlockGrops){var e={x:this._curBlockGrops.centerPoint.x,y:this._curBlockGrops.centerPoint.y+1};this.testPoint(this._curBlockGrops.getCurTeris(),e)?(this._curBlockGrops.blockGrops.forEach((function(e){t._exites.push(e)})),this.switchGrops()):(this._curBlockGrops.pointhandler(e),this.down())}},t.prototype.reset=function(){this.init()},Object.defineProperty(t.prototype,"state",{get:function(){return this._curStatus},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"grade",{set:function(t){var e;this._grade=t,t>0&&t<=300&&(this._dureation=n.Duration.default-3*t),null===(e=this._viewer)||void 0===e||e.showGrade(this._grade)},enumerable:!1,configurable:!0}),t}();e.Game=c},function(t,e,i){"use strict";var o=this&&this.__importDefault||function(t){return t&&t.__esModule?t:{default:t}};Object.defineProperty(e,"__esModule",{value:!0}),e.BlockGrops=void 0;var n=i(2),r=i(7),s=i(8),a=o(i(1)),u=function(){function t(t,e,i){var o=this;this._Teris=t,this._centerPoint=e,this._index=i,this._BlockGrops=[],t[this._index].forEach((function(t){var i=new s.Block(t,n.Teris.createColor());i.point={x:t.x+e.x,y:t.y+e.y},i.viewer=new r.BlockViewer(i,a.default("#next")),o._BlockGrops.push(i)}))}return t.prototype.pointhandler=function(t){var e=this;this._centerPoint=t,this._BlockGrops.forEach((function(i,o){i.point={x:e._Teris[e._index][o].x+t.x,y:e._Teris[e._index][o].y+t.y}}))},t.prototype.changeIndex=function(){this._index=(this._index+1)%this._Teris.length,this.pointhandler(this._centerPoint)},t.prototype.changeDom=function(t){this._BlockGrops.forEach((function(e){var i;null===(i=e.viewer)||void 0===i||i.setContainer(t)}))},Object.defineProperty(t.prototype,"blockGrops",{get:function(){return this._BlockGrops},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"centerPoint",{get:function(){return this._centerPoint},set:function(t){this._centerPoint=t},enumerable:!1,configurable:!0}),t.prototype.getCurTeris=function(){return this._Teris[this._index]},t.prototype.getNextTeris=function(){return this._Teris[(this._index+1)%this._Teris.length]},t}();e.BlockGrops=u},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.BlockViewer=void 0;var o=i(0),n=function(){function e(t,e){this._block=t,this._container=e,this.show()}return e.prototype.setContainer=function(t){this._container=t,this.show()},e.prototype.show=function(){this._dom||(this._dom=t("<div>").css({height:o.BlockConfig.height,width:o.BlockConfig.width,backgroundColor:this._block.color,position:"absolute"})),this._dom.css({left:this._block.point.x*o.BlockConfig.width,top:this._block.point.y*o.BlockConfig.height}).appendTo(this._container)},e.prototype.remove=function(){var t;null===(t=this._dom)||void 0===t||t.remove(),this._dom=void 0},e}();e.BlockViewer=n}).call(this,i(1))},function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0}),e.Block=void 0;var o=function(){function t(t,e){this._point=t,this._color=e}return Object.defineProperty(t.prototype,"point",{get:function(){return this._point},set:function(t){var e;this._point=t,null===(e=this.viewer)||void 0===e||e.show()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){return this._color},enumerable:!1,configurable:!0}),t}();e.Block=o},function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.GameViewer=void 0;var o=i(0),n=function(){function e(){this.msg=t("#msg")}return e.prototype.start=function(){this.msg.css("display","none")},e.prototype.pause=function(){this.msg.css("display","flex").find("span").html("游戏暂停，点击开始!")},e.prototype.over=function(){this.msg.css("display","flex").find("span").html("游戏结束,点击重新开始!")},e.prototype.init=function(e){var i=this;t("#game").css({height:o.BlockConfig.height*o.GameConfig.height,width:o.BlockConfig.width*o.GameConfig.width}),this.msg.css({height:o.BlockConfig.height*o.GameConfig.height,width:o.BlockConfig.width*o.GameConfig.width}),t("#next").css({height:o.BlockConfig.height*o.Panel.height,width:o.BlockConfig.width*o.Panel.width}),t(document).keydown((function(t){if(32===t.keyCode)e.state===o.GameStatus.init||e.state===o.GameStatus.pause?(e.start(),i.start()):e.state===o.GameStatus.playing&&(e.pause(),i.pause());else if(37===t.keyCode){if(e.state!==o.GameStatus.playing)return;e.left()}else if(38===t.keyCode){if(e.state!==o.GameStatus.playing)return;e.rotate()}else if(39===t.keyCode){if(e.state!==o.GameStatus.playing)return;e.right()}else if(40===t.keyCode){if(e.state!==o.GameStatus.playing)return;e.down()}})),t(".start").on("click",(function(){e.state!==o.GameStatus.playing&&(i.start(),e.start())})),t(".pause").on("click",(function(){e.state===o.GameStatus.playing&&(i.pause(),e.pause())})),t(".reset").on("click",(function(){e.reset(),i.start(),e.start()})),t(".left").on("click",(function(){e.state===o.GameStatus.playing&&e.left()})),t(".right").on("click",(function(){e.state===o.GameStatus.playing&&e.right()})),t(".up").on("click",(function(){e.state===o.GameStatus.playing&&e.rotate()})),t(".down").on("click",(function(){e.state===o.GameStatus.playing&&e.down()})),t(".btn").on("click",(function(){e.state===o.GameStatus.init||e.state===o.GameStatus.pause?(i.start(),e.start()):e.state===o.GameStatus.over?(e.init(),i.start(),e.start()):e.state===o.GameStatus.playing&&(i.pause(),e.pause())}))},e.prototype.showGrade=function(e){t("#score").html(""+e)},e}();e.GameViewer=n}).call(this,i(1))}]);